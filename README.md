# 3-Omega Data Analyzer: Explanation

## 1. Introduction

This document provides an explanation for the "3-Omega Data Analyzer" web application. This tool is designed to analyze experimental data obtained from the 3-omega (3ω) method to determine the thermal conductivity and thermal diffusivity of materials, typically thin films or substrates.

The 3-omega method is an AC technique where a metal line on the sample surface acts as both a heater and a thermometer. An AC current at frequency ω is passed through the line, causing Joule heating at frequency 2ω. Due to the material's temperature coefficient of resistance (TCR), this temperature oscillation induces a small voltage component at the third harmonic, 3ω. The magnitude and phase of this V(3ω) signal are directly related to the thermal properties of the underlying material.

This program automates the process of parsing raw data files, performing the necessary calculations and linear fits, and generating comprehensive reports.

## 2. How the Program Works

### 2.1. Data Loading and Parsing

-   **File Upload**: The user starts by uploading a `.dat` file containing the experimental data.
-   **File Structure**: The program expects a specific format:
    1.  An optional JSON header enclosed in `{...}` containing metadata like the experiment's start time.
    2.  One or more data blocks, each separated by `***`.
    3.  Each data block must contain the initial resistance `R0` on a line like `--- > R0 : 58.17 ...`.
    4.  The main data table follows, with columns for time, frequency, current, and the in-phase (V3x) and out-of-phase (V3y) components of the third-harmonic voltage.

    ```
    {
      "start time": "2025-07-25 04:05:23"
    }
    ***
    --- > R0 : 58.17
    time /sec   freq /Hz ... V3x /V ... V3y /V
    1.0         0.10       ... 1.2e-6 ... 3.4e-7
    2.0         0.20       ... 1.1e-6 ... 3.2e-7
    ...
    ***
    ```

An example of the 2D-3omega datafile generated by the programs in my lab is given in this repository. Also, you can find in convert_3omega repository a converter that will take a datafile obtained with sim_3omega and convert it to this calc_3omega program. I wrote it to test the program consistencies (if there are bugs, then they are in both programs and of same consequences)

### 2.2. Parameter Input

The user must provide several key experimental parameters in SI units (though entered in the UI in more common units like mm):

-   **Voltage Probe Distance (L)**: The length of the heater line between the voltage probes [m].
-   **Wire Width (2b)**: The total width of the heater line [m].
-   **TCR (α)**: The Temperature Coefficient of Resistance of the heater material [1/K].
-   **Substrate Thickness (dₛ)**: The thickness of the substrate material [m].

### 2.3. Data Processing and Analysis

1.  **Current Conversion**: The data file provides the heating current as a peak value in milliamps. The analysis requires the RMS value in Amps. The conversion is:
    `I_rms = I_peak_mA * 1e-3 / sqrt(2)`

2.  **Voltage Normalization**: The third-harmonic voltage components (V3x and V3y) are normalized by the cube of the RMS current (`I_rms^3`). This normalization is crucial because the V3 signal is proportional to `I^3`.

3.  **Linear Fitting**: The core of the analysis is a linear fit. The program plots the normalized in-phase voltage (`V3_in-phase / I_rms^3`) against the natural logarithm of the angular frequency (`ln(2ω)`). In the frequency range where heat flow is one-dimensional into the substrate, this relationship is linear.
    -   **Fit Methods**: The user can choose between two fitting methods:
        -   **Weighted Least Squares (WLS)**: Standard linear regression that weights each data point by the inverse of its variance.
        -   **Robust (Bisquare)**: An iterative method that is less sensitive to outliers. It assigns lower weights to points that are far from the fitted line.

### 2.4. Calculation of Physical Properties

-   **Thermal Conductivity (k)**: The thermal conductivity of the substrate is calculated from the slope of the linear fit of the in-phase data. The relationship, derived from the heat conduction equation for a line source on a semi-infinite substrate, is:

    `k = - (R0^2 * alpha_TCR) / (4 * pi * L * Slope)`

    Where:
    - `R0` is the initial resistance of the heater.
    - `alpha_TCR` is the TCR.
    - `L` is the heater length.
    - `Slope` is the slope of the `(V3_in-phase / I_rms^3)` vs. `ln(2ω)` plot. The slope is negative, so the leading minus sign ensures `k` is positive.

-   **Thermal Diffusivity (α)**: The thermal diffusivity is estimated using an approximation based on the frequency range of the fit. It uses the concept of a "corner frequency" where the thermal penetration depth equals the heater half-width. The program uses a simplified empirical formula:

    `alpha_diffusivity = f_max_fit * 100 * pi * b^2`

    Where:
    - `f_max_fit` is the maximum frequency used in the linear fit.
    - `b` is the heater half-width (`wire_width / 2`).
    This is an estimation and may not be accurate for all geometries and materials.

### 2.5. Visualization and Reporting

-   **Interactive Plot**: The application generates an interactive plot showing the normalized in-phase and out-of-phase data points along with the calculated linear fits. The x-axis is `ln(2ω)` and the top axis shows the corresponding Frequency in Hz.
-   **PDF Report**: A "Save Report" button allows the user to generate a multi-page PDF document. The report includes the raw file header, a summary of parameters and results for each dataset, and the corresponding plot, all formatted for clear presentation.

